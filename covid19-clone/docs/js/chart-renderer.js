const t={chartsDataFile:"https://raw.githubusercontent.com/cagov/covid-static/staging/data/infections-by-group/infections-by-group-california.json",chartsStateDashTablesLoc:"https://raw.githubusercontent.com/cagov/covid-static-data/CovidStateDashboardTables_Staging/data/dashboard/",chartsStateDashTablesLocSparklineVaccines:"https://raw.githubusercontent.com/cagov/covid-static-data/CovidStateDashboardVaccines_Sparkline_Staging/data/dashboard/",chartsStateDashTablesLocPostvax:"https://files.covid19.ca.gov/data/dashboard/"};function e(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&a.firstChild?a.insertBefore(n,a.firstChild):a.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}function i(t,{post_chartTitle:e="chart title"}){return'\n            <div class="svg-holder"></div>\n    '}function a(t){let e={};return t.querySelectorAll("[data-label]").forEach((t=>{e[t.dataset.label]=t.innerHTML})),t.querySelectorAll("[data-group]").forEach((t=>{let i=t.getAttribute("data-group"),a=t.querySelectorAll("[data-item]");if(null!==i&&null!==a){let t={};a.forEach((e=>{let i=e.getAttribute("data-item");t[i]=e.innerHTML})),e[i]=t}})),e}function n(){window.charts={};const t=()=>{let t=window.innerWidth,e=(window.innerHeight,(window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)").matches)||window.devicePixelRatio&&window.devicePixelRatio>=2)&&/(iPad|iPhone|iPod)/g.test(navigator.userAgent)),i=window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 124dpi), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 48.8dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (min-device-pixel-ratio: 1.3)").matches)||window.devicePixelRatio&&window.devicePixelRatio>1.3;(screen.orientation||{}).type||screen.mozOrientation||screen.msOrientation,void 0!==window.charts&&(t<=576?(window.charts.displayType="mobile",!0!==i&&!0!==e||(window.charts.displayType="retina")):window.charts.displayType=t>576&&t<=768?"tablet":"desktop")},e=()=>{t()};window.addEventListener("resize",e),e()}function s(t,e=".svg-holder",i="ltr"){let a=t.querySelector(e);null!=a&&a.setAttribute("dir",i)}e("cagov-chart-dashboard-sparkline.chart div.svg-holder {\n  margin-left: 10%;\n  margin-right: 10%; }\n\ncagov-chart-dashboard-sparkline.chart .svg-holder g.fg-bars {\n  fill: #00183f; }\n\ncagov-chart-dashboard-sparkline.chart .svg-holder g.fg-line path {\n  fill: none;\n  stroke: #92c5de;\n  stroke-width: 2px; }\n\ncagov-chart-dashboard-sparkline.chart .svg-holder g.fg-region path {\n  fill: #00183f;\n  stroke: none;\n  opacity: 0.5; }\n\ncagov-chart-dashboard-sparkline.chart .svg-holder g.fg-line.second-line path {\n  opacity: 0.5; }\n\ndiv.sparkline-prev-div {\n  width: 440px;\n  background-color: #003d9d;\n  margin-bottom: 2rem; }\n");var r={cases:{sparkline:{chartName:"cagov-chart-dashboard-sparkline",chart_style:"normal",seriesField:"CONFIRMED_CASES_EPISODE_DATE",comment_avg:"The below average field is unused",seriesFieldAvg:"AVG_CASE_RATE_PER_100K_7_DAYS",dataUrl:"confirmed-cases/california.json",dataPathVar:"chartsStateDashTablesLoc",rootId:"cases-ep",display_weeks:8,uncertainty_days_override:0,uncertainty_latest_field:"CONFIRMED_CASES",uncertainty_date_field:"EPISODE_UNCERTAINTY_PERIOD",bar_color:"#00183f",line_color:"#92c5de",stroke_width:2}},deaths:{sparkline:{chartName:"cagov-chart-dashboard-sparkline",chart_style:"normal",seriesField:"CONFIRMED_DEATHS_DEATH_DATE",comment_avg:"The below average field is unused",seriesFieldAvg:"AVG_DEATH_RATE_PER_100K_7_DAYS",dataUrl:"confirmed-deaths/california.json",dataPathVar:"chartsStateDashTablesLoc",rootId:"death-date",display_weeks:8,uncertainty_days_override:0,uncertainty_latest_field:"CONFIRMED_DEATHS",uncertainty_date_field:"DEATH_UNCERTAINTY_PERIOD",bar_color:"#00183f",line_color:"#92c5de",stroke_width:2}},tests:{sparkline:{chartName:"cagov-chart-dashboard-sparkline",chart_style:"normal",seriesField:"DAILY_TEST_POSITIVITY_RATE",comment_avg:"The below average field is unused",seriesFieldAvg:"TEST_POSITIVITY_RATE_7_DAYS",dataUrl:"positivity-rate/california.json",dataPathVar:"chartsStateDashTablesLoc",rootId:"tests-tests",display_weeks:8,uncertainty_days_override:0,uncertainty_latest_field:"POSITIVITY_RATE",uncertainty_date_field:"TESTING_UNCERTAINTY_PERIOD",bar_color:"#00183f",line_color:"#92c5de",stroke_width:2}},vaccines:{sparkline:{chartName:"cagov-chart-dashboard-sparkline",chart_style:"normal",seriesField:"VACCINE_DOSES",comment_avg:"The below average field is unused",seriesFieldAvg:"VACCINE_DOSES_7DAYAVG",dataUrl:"vaccines/sparkline.json",dataPathVar:"chartsStateDashTablesLocSparklineVaccines",rootId:"tests-vaccines",display_weeks:8,uncertainty_days_override:7,uncertainty_latest_field:"",uncertainty_date_field:"",bar_color:"#00183f",line_color:"#92c5de",stroke_width:2}},desktop:{fontSize:14,width:200,height:100,margin:{left:2,top:0,right:2,bottom:0}},tablet:{fontSize:14,width:200,height:100,margin:{left:2,top:0,right:2,bottom:0}},mobile:{fontSize:12,width:260,height:100,margin:{left:2,top:0,right:2,bottom:0}},retina:{fontSize:12,width:260,height:100,margin:{left:2,top:0,right:2,bottom:0}}};function o(t,e,i,a,{root_id:n="barid",is_second_line:s=!1,crop_floor:r=!0,chart_options:o=null}){a.domain()[1],i.domain()[1],t.append("g").attr("class","fg-line "+n+(s?" second-line":"")).attr("fill","none").attr("stroke",o.line_color).attr("stroke-width",o.stroke_width).attr("stroke-linecap","round").append("path").datum(e).attr("d",d3.line().x((function(t,e){return i(e)})).y((function(t){return a(r?Math.max(0,t.VALUE):t.VALUE)})))}function l(t,e,i,a,{root_id:n="barid",is_second_line:s=!1,crop_floor:r=!0,chart_options:o=null}){a.domain()[1],i.domain()[1],t.append("g").attr("class","fg-region").attr("stroke","none").append("path").datum(e).attr("class","area").attr("d",d3.area().x((function(t,e){return i(e)})).y0(a(0)).y1((function(t){return a(r?Math.max(0,t.VALUE):t.VALUE)})))}function h(t,e,i,a,{root_id:n="barid",crop_floor:s=!0,chart_style:r="normal",chart_options:o=null}){let l="solid"==r?4:2;s||console.log("NOT CROP FLOOR");let h=t.append("g").attr("class","fg-bars "+n).attr("fill",o.bar_color).attr("stroke","none").selectAll("g").data(e).enter().append("g");s?h.append("rect").attr("x",((t,e)=>i(e)-l/2)).attr("y",(t=>a(t.VALUE))).attr("width",l).attr("height",(t=>Math.max(a(0)-a(t.VALUE),0))).attr("id",((t,e)=>n+"-"+e)):h.append("rect").attr("x",((t,e)=>i(e))).attr("y",(t=>Math.min(a(0),a(t.VALUE)))).attr("width",2).attr("height",(t=>Math.abs(a(0)-a(t.VALUE)))).attr("id",((t,e)=>n+"-"+e))}function c({chart_style:t="normal",extras_func:e=null,time_series_bars:i=null,time_series_line:a=null,time_series_state_line:n=null,line_date_offset:s=0,crop_floor:r=!0,published_date:c="YYYY-MM-DD",render_date:d="YYYY-MM-DD",root_id:p="barid",chart_options:m={bar_color:"#FF0000",line_color:"#00FF00",stroke_width:10}}){if(this.svg=d3.select(this.querySelector(".svg-holder")).append("svg"),this.svg.attr("about","DATA_PUBLISHED_DATE:"+c+",RENDER_DATE:"+d).attr("xmlns","http://www.w3.org/2000/svg"),this.svg.attr("viewBox",[0,0,this.chartBreakpointValues.width,this.chartBreakpointValues.height]).append("g").attr("transform","translate(0,0)"),this.tooltip=d3.select(this.chartOptions.chartName).append("div").attr("class","tooltip-container").text("Empty Tooltip"),i){this.xbars=d3.scaleLinear().domain([0,i.length-1]).range([this.dimensions.width-this.dimensions.margin.right,this.dimensions.margin.left]);let t=r?0:d3.min(i,(t=>t.VALUE));t>0&&(t=0);let e=d3.max(i,(t=>t.VALUE));0==e&&(e=1),this.ybars=d3.scaleLinear().domain([t,e]).nice().range([this.dimensions.height-this.dimensions.margin.bottom,this.dimensions.margin.top])}if(a){const t=s;this.xline=d3.scaleLinear().domain([t+0,t+a.length-1]).range([this.dimensions.width-this.dimensions.margin.right,this.dimensions.margin.left]),!r&&d3.min(a,(t=>t.VALUE));let e=d3.max(a,(t=>t.VALUE));0==e&&(e=1),n&&(e=Math.max(e,d3.max(n,(t=>t.VALUE))))}i&&"no-bars"!=t&&"solid-region"!=t&&h.call(this,this.svg,i,this.xbars,this.ybars,{root_id:p,crop_floot:r,chart_style:t,chart_options:m}),a&&("solid-region"==t&&l.call(this,this.svg,a,this.xline,this.ybars,{root_id:p,crop_floot:r,chart_options:m}),o.call(this,this.svg,a,this.xline,this.ybars,{root_id:p,crop_floot:r,chart_options:m})),e&&e.call(this,this.svg)}function d(t){let e=new Date;return e.setDate(e.getDate()+t),function(t){let e=""+(t.getMonth()+1),i=""+t.getDate(),a=t.getFullYear();return e.length<2&&(e="0"+e),i.length<2&&(i="0"+i),[a,e,i].join("-")}(e)}function p(t,e={month:"long",day:"numeric",year:"numeric"},i=0){const a=function(t){const e=t.split("-"),i=+e[0],a=+e[1],n=+e[2];return new Date(i,a-1,n)}(t);return 0!=i&&a.setDate(a.getDate()+i),function(t,e={month:"long",day:"numeric",year:"numeric"}){return t.toLocaleString(document.documentElement.lang,e)}(a,e)}class m extends window.HTMLElement{connectedCallback(){this.translationsObj=a(this),this.chartConfigFilter=this.dataset.chartConfigFilter,this.chartConfigKey=this.dataset.chartConfigKey,this.chartOptions=r[this.chartConfigKey][this.chartConfigFilter],console.log("Loading CAGovDashboardSparkline",this.chartConfigFilter,this.chartConfigKey),n(),this.screenDisplayType=window.charts?window.charts.displayType:"desktop",this.chartBreakpointValues=r[this.screenDisplayType],this.dimensions=this.chartBreakpointValues;window.addEventListener("resize",(()=>{n(),this.screenDisplayType=window.charts?window.charts.displayType:"desktop",this.chartBreakpointValues=r[this.screenDisplayType?this.screenDisplayType:"desktop"]})),this.dataUrl=t[this.chartOptions.dataPathVar]+this.chartOptions.dataUrl,this.retrieveData(this.dataUrl),s(this)}ariaLabel(t,e){return""}getLegendText(){return[]}renderExtras(t,e,i,a){}renderComponent(){this.innerHTML=i.call(this,this.chartOptions,this.translationsObj);let t=this.chartOptions.display_weeks,e=this.chartOptions.uncertainty_days_override;if(0==e&&""!=this.chartOptions.uncertainty_latest_field){const t=this.chartdata.latest[this.chartOptions.uncertainty_latest_field][this.chartOptions.uncertainty_date_field],i=this.chartdata.time_series[this.chartOptions.seriesField].VALUES;e=0;for(let a=0;a<i.length&&(e+=1,i[a].DATE!=t);++a);e>28&&(console.log("Problem calcuating uncertainty period",this.dataset.chartConfigKey,this.chartdata),e=7)}let a=this.chartdata.time_series[this.chartOptions.seriesField].VALUES;a=JSON.parse(JSON.stringify(a));let n=[];"no_average"in this.chartOptions&&this.chartOptions.no_average?(console.log("Skipping averaging for ",this.dataset.chartConfigKey),n=JSON.parse(JSON.stringify(a))):a.forEach(((t,e)=>{let i=0;for(let t=e;t<e+7;++t)i+=t<a.length?a[t].VALUE:0;n.push({DATE:t.DATE,VALUE:i/7})})),a=a.splice(e,7*t),n=n.splice(e,7*t);let s={chart_style:this.chartOptions.chart_style,extras_func:this.renderExtras,time_series_bars:a,time_series_line:n,left_y_fmt:"pct",root_id:this.chartOptions.rootId,right_y_fmt:"integer",published_date:this.metadata.PUBLISHED_DATE,render_date:d(0),chart_options:this.chartOptions};console.log("RENDERING CHART",this.chartConfigFilter,this.chartConfigKey),c.call(this,s)}retrieveData(t){window.fetch(t).then((t=>t.json())).then(function(t){this.metadata=t.meta,this.chartdata=t.data,this.renderComponent()}.bind(this))}}window.customElements.define("cagov-chart-dashboard-sparkline",m);function g(t,{post_chartTitle:e="chart title",post_chartImpactStatement:i="chart title",post_yaxis_legend:a="y axis title",post_series1_legend:n="Vaccinated",post_series2_legend:s="Unvaccinated",post_series3_legend:r="All cases",mode_3lines:o=!1}){return'\n   <div class="postvax-chart">\n      <div class="svg-holder"></div>\n   </div>\n    '}e('cagov-chart-dashboard-postvax-chart-prerender .chart-title {\n  font-weight: 300;\n  font-size: 1.2rem;\n  margin-bottom: 2rem; }\n\ncagov-chart-dashboard-postvax-chart-prerender .chart-title.noborder {\n  border: none;\n  margin-bottom: 2rem; }\n\n.postvax-chart {\n  max-width: 615px; }\n  .postvax-chart .svg-holder g.fg-line path {\n    fill: none;\n    stroke: #1f2574;\n    stroke-width: 2px; }\n  .postvax-chart .svg-holder g.fg-line.line_s1 path {\n    stroke: #1f2574; }\n  .postvax-chart .svg-holder g.fg-line.line_s2 path {\n    stroke: #dc4567; }\n  .postvax-chart .svg-holder g.fg-line.line_s3 path {\n    stroke: #cccccc; }\n  .postvax-chart .svg-holder g.fg-line.line_s3 path {\n    stroke-dasharray: "1 3"; }\n  .postvax-chart .svg-holder g.date-axis line {\n    stroke-width: 0.5px;\n    stroke: black; }\n  .postvax-chart .svg-holder g.date-axis text {\n    font-weight: 300;\n    font-size: 0.85rem;\n    fill: black; }\n  .postvax-chart .svg-holder g.date-axis text {\n    text-anchor: middle;\n    dominant-baseline: hanging; }\n  .postvax-chart .svg-holder g.date-axis text.x-axis-legend {\n    font-weight: 300;\n    text-anchor: end;\n    dominant-baseline: middle; }\n  .postvax-chart .svg-holder g.left-y-axis line {\n    stroke-width: 0.5px;\n    stroke: black;\n    opacity: 0.15; }\n  .postvax-chart .svg-holder g.left-y-axis text {\n    font-weight: 300;\n    font-size: 0.85rem;\n    fill: black; }\n  .postvax-chart .svg-holder g.left-y-axis text {\n    text-anchor: end;\n    dominant-baseline: middle; }\n  .postvax-chart .svg-holder g.left-y-axis text.left-y-axis-legend {\n    font-weight: 300;\n    font-size: 0.85rem;\n    text-anchor: start;\n    dominant-baseline: hanging; }\n  .postvax-chart .svg-holder g.tt-marker {\n    fill: black;\n    opacity: 0.15; }\n  .postvax-chart .svg-holder g.pending-block-postvax rect {\n    opacity: 0.4; }\n  .postvax-chart .svg-holder g.pending-block-postvax text {\n    font-weight: 300;\n    font-size: 0.85rem;\n    fill: black; }\n  .postvax-chart .svg-holder g.pending-block-postvax text {\n    text-anchor: end;\n    dominant-baseline: auto; }\n  .postvax-chart .y-axis-title {\n    font-weight: 300;\n    font-size: 0.85rem; }\n  .postvax-chart span.chart-legend {\n    float: right; }\n  .postvax-chart svg.legend-line {\n    width: 24px;\n    height: 15px; }\n  .postvax-chart svg.legend-line path {\n    stroke-width: 3; }\n  .postvax-chart svg.series2-legend-line path {\n    stroke: #dc4567; }\n  .postvax-chart svg.series1-legend-line path {\n    stroke: #1f2574; }\n  .postvax-chart svg.series3-legend-line path {\n    stroke: #cccccc; }\n  .postvax-chart div.tooltip-container {\n    font-weight: 300;\n    font-size: 0.75rem;\n    line-height: 2;\n    color: black;\n    text-align: center; }\n  .postvax-chart .tooltip-container {\n    position: absolute;\n    z-index: 10;\n    visibility: hidden;\n    background: #fff;\n    width: 280px; }\n  .postvax-chart .tooltip-container {\n    pointer-events: none;\n    /* padding: 10px; */\n    padding: 1rem 2rem;\n    box-shadow: 0px 0px 5px 2px rgba(0, 0, 0, 0.14);\n    /* box-shadow: -12px 11px 5px -4px rgba(0, 0, 0, 0.4); */\n    border: none; }\n  .postvax-chart .pending-caveat {\n    font-style: italic; }\n  .postvax-chart a.dlbutton {\n    border-radius: 3px;\n    background-color: aqua;\n    color: blue;\n    font-weight: 300;\n    font-size: 0.5rem; }\n\n.diagonal-stripe-1 {\n  background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxMCcgaGVpZ2h0PScxMCc+CiAgPHJlY3Qgd2lkdGg9JzEwJyBoZWlnaHQ9JzEwJyBmaWxsPSd3aGl0ZScvPgogIDxwYXRoIGQ9J00tMSwxIGwyLC0yCiAgICAgICAgICAgTTAsMTAgbDEwLC0xMAogICAgICAgICAgIE05LDExIGwyLC0yJyBzdHJva2U9J2JsYWNrJyBzdHJva2Utd2lkdGg9JzEnLz4KPC9zdmc+Cg==");\n  background-repeat: repeat; }\n\n.d-hide {\n  display: none; }\n\ndiv.chart-prev-div {\n  width: 700px;\n  margin-bottom: 2rem; }\n');var _={cases:{weeks:{chartName:"#postvax-cases-chart",series_fields:["BREAKTHROUGH_CASE_RATE","UNVAX_CASE_RATE"],series_colors:["#1f2574","#dc4567"],x_axis_field:"DATE",dataUrl:"postvax/california.json",days_to_show:120,root_id:"postvax-cases",pending_days:7,pre_mult:1,stroke_width:2,line_1_color:"#1f2574",line_2_color:"#dc4567",line_3_color:"#cccccc"}},hospitalizations:{weeks:{chartName:"#postvax-hospitalizations-chart",series_fields:["BREAKTHROUGH_HOSP_RATE","UNVAX_HOSP_RATE"],series_colors:["#1f2574","#dc4567"],x_axis_field:"DATE",dataUrl:"postvax/california.json",days_to_show:120,earliest_date:"2021-07-24",root_id:"postvax-hospitalizations",pending_days:14,pre_mult:10,stroke_width:2,line_1_color:"#1f2574",line_2_color:"#dc4567",line_3_color:"#cccccc"}},deaths:{weeks:{chartName:"#postvax-deaths-chart",series_fields:["BREAKTHROUGH_DEATH_DOD_RATE","UNVAX_DEATH_DOD_RATE"],series_colors:["#1f2574","#dc4567"],x_axis_field:"DATE",dataUrl:"postvax/california.json",days_to_show:120,root_id:"postvax-deaths",pending_days:21,pre_mult:10,stroke_width:2,line_1_color:"#1f2574",line_2_color:"#dc4567",line_3_color:"#cccccc"}},desktop:{fontSize:14,width:615,height:400,margin:{left:50,top:30,right:2,bottom:45}},tablet:{fontSize:14,width:400,height:300,margin:{left:50,top:30,right:2,bottom:45}},mobile:{fontSize:12,width:400,height:300,margin:{left:50,top:30,right:2,bottom:45}},retina:{fontSize:12,width:400,height:300,margin:{left:50,top:30,right:2,bottom:45}}};function f(t,e,i,a,n,{root_id:s="barid",line_id:r="line_s0",line_idx:o=1,color:l="black",crop_floor:h=!0,chart_options:c=null}){n.domain()[1],a.domain()[1];let d=t.append("g").attr("class","fg-line "+s+" "+r).attr("stroke",c["line_"+o+"_color"]).attr("stroke-width",c.stroke_width+"px").attr("fill","none");"line_s3"==r&&d.attr("stroke-dasharray","1 3"),d.append("path").datum(e).attr("d",d3.line().x((function(t,e){return a(e)})).y((function(t){return n(h?Math.max(0,t[i]):t[i])})))}function u(t,e,i,a,n,{week_modulo:s=3,root_id:r="barid"}){const o=this.dimensions.height-this.dimensions.margin.bottom;let l=t.append("g").attr("class","date-axis").attr("style","stroke-width: 0.5px; stroke:black;");e.forEach(((t,n)=>{const r=t[i].split("-"),h=parseInt(r[0]),c=parseInt(r[1]);if(n%s==0){const t=parseInt(r[2]);let i=l.append("g").attr("class","x-tick");if(0==n||n==e.length-1){const e=c+"/"+t+"/"+h;let s=0==n?"start":"end";i.append("text").text(e).attr("style","font-family:sans-serif; font-weight:300; font-size: 0.85rem; fill:black;text-anchor: "+s+"; dominant-baseline:hanging;").attr("x",a(n)).attr("y",o+1+4+12)}}}))}function x(t,e,i,{y_fmt:a="num",root_id:n="barid"}){const s=function(t,{hint:e="num"}){const i=t.domain()[1],a=Math.log10(i),n=Math.floor(a),s=Math.pow(10,n),r=a-n;if(r<.176)var o=5;else if(r<.477)o=2;else if(r<.778)o=1;else o=.5;let l=s/o;"integer"==e&&l<1&&(l=1);return l}(i,{hint:a});let r=t.append("g").attr("class","left-y-axis");const o=i.domain()[1],l=e.domain()[0],h=e.domain()[1];let c=function(t,{hint:e="num",digits:i=0}){if("pct"==e){const e=t<.01?2:t<.1?1:0;return new Intl.NumberFormat("us",{style:"percent",minimumFractionDigits:e,maximumFractionDigits:e}).format}if(t<4e3){const i="integer"==e?0:t<.1?2:t<10?1:0;return new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:i,maximumFractionDigits:i}).format}if(t<1e6){const e=t<4e3?1:0,i=new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:e,maximumFractionDigits:e});return function(t){return i.format(t/1e3)+"K"}}if(t<1e9){const e=t<4e6?1:0,i=new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:e,maximumFractionDigits:e});return function(t){return i.format(t/1e6)+"M"}}{const e=t<4e9?1:0,i=new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:e,maximumFractionDigits:e});return function(t){return i.format(t/1e3)+"M"}}}(o,{hint:a});for(let t=0;t<=o;t+=s){let a=c(t),n=r.append("g").attr("class","y-tick");n.append("line").attr("style","stroke-width: 0.5px; stroke:black; opacity:0.15;").attr("x1",e(h)).attr("y1",i(t)).attr("x2",e(l)).attr("y2",i(t)),n.append("text").text(a).attr("style","font-family:sans-serif; font-weight:300; font-size: 0.85rem; fill:black;text-anchor: end; dominant-baseline:middle;").attr("x",e(l)-10).attr("y",i(t))}}function y({tooltip_func:t=null,extras_func:e=null,chartdata:i=null,series_fields:a=null,series_colors:n=null,x_axis_field:s=null,line_date_offset:r=0,y_fmt:o="num",published_date:l="YYYY-MM-DD",render_date:h="YYYY-MM-DD",crop_floor:c=!1,root_id:d="postvaxid",chart_options:p={}}){console.log("renderChart",d),this.svg=d3.select(this.querySelector(".svg-holder")).append("svg"),this.svg.attr("about","DATA_PUBLISHED_DATE:"+l+",RENDER_DATE:"+h).attr("xmlns","http://www.w3.org/2000/svg"),this.svg.attr("viewBox",[0,0,this.chartBreakpointValues.width,this.chartBreakpointValues.height]),this.svg.append("g").attr("transform","translate(0,0)").attr("style","fill:#CCCCCC;"),this.tooltip=d3.select(this.chartOptions.chartName).append("div").attr("class","tooltip-container").text("Empty Tooltip");let m=Math.max(d3.max(i,(t=>t[a[0]])),d3.max(i,(t=>t[a[1]])));this.yline=d3.scaleLinear().domain([0,m]).nice().range([this.dimensions.height-this.dimensions.margin.bottom,this.dimensions.margin.top]);const g=r;this.xline=d3.scaleLinear().domain([g+0,g+i.length-1]).range([this.dimensions.margin.left,this.dimensions.width-this.dimensions.margin.right]),a.forEach(((t,e)=>{f.call(this,this.svg,i,t,this.xline,this.yline,{root_id:d+"_l"+(e+1),line_id:"line_s"+(e+1),line_idx:e+1,crop_floor:c,color:n[e],chart_options:p})})),x.call(this,this.svg,this.xline,this.yline,{y_fmt:o,root_id:d}),u.call(this,this.svg,i,s,this.xline,this.yline,{week_modulo:1,root_id:d}),e&&e.call(this,this.svg)}function v(t,e){for(const i in e){const a=e[i];t=(t=(t=t.replace("{{"+i+"}}",a)).replace("{"+i+"}",a)).replace("("+i+")",a)}return t}let b=new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0}),w=new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:1,maximumFractionDigits:1}),E=new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),D=new Intl.NumberFormat("us",{style:"decimal",minimumFractionDigits:3,maximumFractionDigits:3}),T=new Intl.NumberFormat("us",{style:"percent",minimumFractionDigits:0,maximumFractionDigits:0}),k=new Intl.NumberFormat("us",{style:"percent",minimumFractionDigits:1,maximumFractionDigits:1}),A=new Intl.NumberFormat("us",{style:"percent",minimumFractionDigits:2,maximumFractionDigits:2}),O=new Intl.NumberFormat("us",{style:"percent",minimumFractionDigits:3,maximumFractionDigits:3});function C(t,{format:e="number",min_decimals:i=1}){return"integer"==e?b.format(t):"percent"==e?0==t?T.format(t):t<5e-5?O.format(t):t<5e-4?A.format(t):0==i?T.format(t):k.format(t):0==t?b.format(t):t<.005?D.format(t):t<.05?E.format(t):0==i?b.format(t):1==i?w.format(t):2==i?E.format(t):D.format(t)}class S extends window.HTMLElement{connectedCallback(){this.translationsObj=a(this),this.chartConfigFilter=this.dataset.chartConfigFilter,this.chartConfigKey=this.dataset.chartConfigKey,console.log("Loading Postvax Chart",this.chartConfigKey,this.chartConfigFilter),this.chartOptions=_[this.chartConfigKey][this.chartConfigFilter],n(),this.screenDisplayType=window.charts?window.charts.displayType:"desktop",this.chartBreakpointValues=_[this.screenDisplayType?this.screenDisplayType:"desktop"],this.dimensions=this.chartBreakpointValues;window.addEventListener("resize",(()=>{n(),this.screenDisplayType=window.charts?window.charts.displayType:"desktop",this.chartBreakpointValues=_[this.screenDisplayType?this.screenDisplayType:"desktop"]})),this.dataUrl=t.chartsStateDashTablesLocPostvax+this.chartOptions.dataUrl,this.retrieveData(this.dataUrl),s(this)}ariaLabel(t,e){return""}getLegendText(){return[]}renderExtras(t){}getTooltipContent(t){const e=this.chartdata[t],i={WEEKDATE:p(e.DATE),VCOUNT:C(e[this.chartOptions.series_fields[0]],{format:"number"}),UCOUNT:C(e[this.chartOptions.series_fields[1]],{format:"number"})};return v(this.translationsObj.tooltipContent,i)}renderComponent(){console.log("Rendering Post Vax Chart");let t=this.chartdata.length-1,e=this.chartdata[t][this.chartOptions.series_fields[1]]/this.chartdata[t][this.chartOptions.series_fields[0]],i=this.chartdata[t].DATE;const a={BEGIN_IMPACT_DATE:p(this.chartdata[t-6].DATE),END_IMPACT_DATE:p(i),RATE_RATIO:C(e,{format:"number"}),RATE_PERCENT:C(e,{format:"number"})};this.translationsObj.post_chartTitle=v(this.translationsObj.chartTitleState,a),this.translationsObj.post_chartImpactStatement=v(this.translationsObj.chartImpactStatement,a),this.translationsObj.post_xaxis_legend=v(this.translationsObj.xaxis_legend,a),this.translationsObj.post_yaxis_legend=v(this.translationsObj.yaxis_legend_daily,a),this.translationsObj.post_series1_legend=v(this.translationsObj.series1_legend,a),this.translationsObj.post_series2_legend=v(this.translationsObj.series2_legend,a),this.translationsObj.post_series3_legend=v(this.translationsObj.series3_legend,a),this.translationsObj.post_pending_legend=v(this.translationsObj.pending_legend,a),this.translationsObj.pending_mode=this.pending_mode,this.innerHTML=g.call(this,this.chartOptions,this.translationsObj);let n=this.chartOptions.series_fields,s=this.chartOptions.series_colors,r={tooltip_func:this.tooltip,extras_func:this.renderExtras,chartdata:this.chartdata,series_fields:n,series_colors:s,pending_legend:this.translationsObj.pending_legend,x_axis_field:this.chartOptions.x_axis_field,y_fmt:"number",root_id:this.chartOptions.root_id,published_date:this.metadata.PUBLISHED_DATE,render_date:d(0),chart_options:this.chartOptions};y.call(this,r)}retrieveData(t){window.fetch(t).then((t=>t.json())).then(function(t){if(this.metadata=t.meta,this.chartdata=t.data,"earliest_date"in this.chartOptions){let t=0;for(let e=0;e<this.chartdata.length&&this.chartdata[e].DATE!=this.chartOptions.earliest_date;e++)t+=1;t>0&&this.chartdata.splice(0,t)}let e=this.chartOptions.days_to_show;console.log("days to show",e);let i=this.chartOptions.pending_days;this.chartdata.splice(this.chartdata.length-i,i),this.chartdata.length>e&&this.chartdata.splice(0,this.chartdata.length-e),this.chartdata.forEach((t=>{t[this.chartOptions.series_fields[0]]*=this.chartOptions.pre_mult,t[this.chartOptions.series_fields[1]]*=this.chartOptions.pre_mult})),this.renderComponent()}.bind(this))}}window.customElements.define("cagov-chart-dashboard-postvax-chart-prerender",S);
